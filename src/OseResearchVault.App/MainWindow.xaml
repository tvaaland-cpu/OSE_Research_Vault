<Window x:Class="OseResearchVault.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="OSE Research Vault"
        Width="1280"
        Height="800"
        MinWidth="980"
        MinHeight="620">
    <Grid>
        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        </Grid.Resources>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="#FF1C2432" Padding="16">
            <StackPanel>
                <TextBlock Foreground="White" FontSize="20" FontWeight="Bold" Text="OSE Research Vault" Margin="0,0,0,24" />
                <ListBox ItemsSource="{Binding NavigationItems}" SelectedItem="{Binding SelectedItem}" BorderThickness="0" Background="Transparent" Foreground="White">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Title}" FontSize="16" Margin="4,8" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </Border>

        <Grid Grid.Column="1" Margin="20" Visibility="{Binding IsCompaniesSelected, Converter={StaticResource BoolToVisibility}}">
            <Grid.RowDefinitions><RowDefinition Height="Auto"/><RowDefinition Height="*"/></Grid.RowDefinitions>
            <StackPanel Margin="0,0,0,12">
                <TextBlock Text="Companies" FontSize="28" FontWeight="SemiBold" />
                <TextBlock Text="{Binding CompanyStatusMessage}" Foreground="#FF2D3748" Margin="0,6,0,0"/>
            </StackPanel>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions><ColumnDefinition Width="2*"/><ColumnDefinition Width="12"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                <DataGrid Grid.Column="0" ItemsSource="{Binding Companies}" SelectedItem="{Binding SelectedCompany}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*"/>
                        <DataGridTextColumn Header="Ticker" Binding="{Binding Ticker}" Width="*"/>
                        <DataGridTextColumn Header="ISIN" Binding="{Binding Isin}" Width="*"/>
                        <DataGridTextColumn Header="Sector" Binding="{Binding Sector}" Width="*"/>
                        <DataGridTextColumn Header="Tags" Binding="{Binding Tags}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
                <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto"><StackPanel>
                    <TextBox Text="{Binding CompanyName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,8" ToolTip="Name"/>
                    <TextBox Text="{Binding CompanyTicker}" Margin="0,0,0,8" ToolTip="Ticker"/>
                    <TextBox Text="{Binding CompanyIsin}" Margin="0,0,0,8" ToolTip="ISIN"/>
                    <TextBox Text="{Binding CompanySector}" Margin="0,0,0,8" ToolTip="Sector"/>
                    <TextBox Text="{Binding CompanyIndustry}" Margin="0,0,0,8" ToolTip="Industry"/>
                    <TextBox Text="{Binding CompanyCurrency}" Margin="0,0,0,8" ToolTip="Currency"/>
                    <TextBox Text="{Binding CompanySummary}" AcceptsReturn="True" Height="80" TextWrapping="Wrap" Margin="0,0,0,8" ToolTip="Summary"/>
                    <TextBlock Text="Tags" FontWeight="SemiBold"/>
                    <ItemsControl ItemsSource="{Binding AvailableTags}" Margin="0,4,0,8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <CheckBox Content="{Binding Name}" IsChecked="{Binding IsSelected}" Margin="0,2"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBox Width="180" Text="{Binding NewTagName, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Content="Add Tag" Margin="8,0,0,0" Command="{Binding AddTagCommand}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="New" Command="{Binding NewCompanyCommand}"/>
                        <Button Content="Save" Margin="8,0,0,0" Command="{Binding SaveCompanyCommand}"/>
                        <Button Content="Delete" Margin="8,0,0,0" Command="{Binding DeleteCompanyCommand}"/>
                    </StackPanel>
                </StackPanel></ScrollViewer>
            </Grid>
        </Grid>

        <Grid Grid.Column="1" Margin="20" Visibility="{Binding IsDocumentsSelected, Converter={StaticResource BoolToVisibility}}">
            <Grid.RowDefinitions><RowDefinition Height="Auto"/><RowDefinition Height="*"/></Grid.RowDefinitions>
            <StackPanel Margin="0,0,0,12">
                <TextBlock Text="Documents" FontSize="28" FontWeight="SemiBold" />
                <TextBlock Text="Drag and drop files into the list to import into vault storage." Foreground="#FF4A5568" />
                <TextBlock Text="{Binding DocumentStatusMessage}" Margin="0,6,0,0" Foreground="#FF2D3748" />
            </StackPanel>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions><ColumnDefinition Width="2*"/><ColumnDefinition Width="12"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                <Border Grid.Column="0" AllowDrop="True" Drop="DocumentDropArea_OnDrop" DragOver="DocumentDropArea_OnDragOver">
                    <DataGrid ItemsSource="{Binding Documents}" SelectedItem="{Binding SelectedDocument}" AutoGenerateColumns="False" IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="2*" />
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="*" />
                            <DataGridTextColumn Header="Company" Binding="{Binding Company}" Width="*" />
                            <DataGridTextColumn Header="Published date" Binding="{Binding PublishedDate}" Width="*" />
                            <DataGridTextColumn Header="Imported date" Binding="{Binding ImportedDate}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
                <StackPanel Grid.Column="2">
                    <TextBlock Text="Link to company" FontWeight="SemiBold"/>
                    <ComboBox ItemsSource="{Binding CompanyOptions}" SelectedItem="{Binding SelectedDocumentCompany}" DisplayMemberPath="DisplayName" Margin="0,4,0,8"/>
                    <Button Content="Save Link" Command="{Binding SaveDocumentCompanyCommand}" Width="120" Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding DetailsSummary}" TextWrapping="Wrap" FontFamily="Consolas" FontSize="12" />
                    <TextBlock Text="Extracted text preview" Margin="0,12,0,4" FontWeight="SemiBold" />
                    <TextBox Text="{Binding DetailsTextPreview}" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" MinHeight="220" />
                </StackPanel>
            </Grid>
        </Grid>

        <Grid Grid.Column="1" Margin="20" Visibility="{Binding IsNotesSelected, Converter={StaticResource BoolToVisibility}}">
            <Grid.RowDefinitions><RowDefinition Height="Auto"/><RowDefinition Height="*"/></Grid.RowDefinitions>
            <StackPanel Margin="0,0,0,12">
                <TextBlock Text="Notes" FontSize="28" FontWeight="SemiBold" />
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <TextBlock Text="Company" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="220" ItemsSource="{Binding NoteFilterCompanies}" SelectedItem="{Binding NotesFilterCompany}" DisplayMemberPath="DisplayName" Margin="0,0,16,0"/>
                    <TextBlock Text="Type" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="160" ItemsSource="{Binding NoteFilterTypes}" SelectedItem="{Binding NotesFilterType}"/>
                </StackPanel>
                <TextBlock Text="{Binding NoteStatusMessage}" Margin="0,6,0,0" Foreground="#FF2D3748" />
            </StackPanel>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions><ColumnDefinition Width="2*"/><ColumnDefinition Width="12"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                <DataGrid Grid.Column="0" ItemsSource="{Binding Notes}" SelectedItem="{Binding SelectedNote}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="2*"/>
                        <DataGridTextColumn Header="Type" Binding="{Binding NoteType}" Width="*"/>
                        <DataGridTextColumn Header="Company" Binding="{Binding CompanyName}" Width="*"/>
                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
                <StackPanel Grid.Column="2">
                    <TextBox Text="{Binding NoteTitle, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,8" ToolTip="Title"/>
                    <ComboBox ItemsSource="{Binding NoteTypes}" SelectedItem="{Binding SelectedNoteType}" Margin="0,0,0,8"/>
                    <ComboBox ItemsSource="{Binding CompanyOptions}" SelectedItem="{Binding SelectedNoteCompany}" DisplayMemberPath="DisplayName" Margin="0,0,0,8"/>
                    <TextBlock Text="Markdown" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding NoteContent}" AcceptsReturn="True" TextWrapping="Wrap" Height="220" Margin="0,0,0,8" VerticalScrollBarVisibility="Auto" FontFamily="Consolas"/>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Import AI Output" Click="ImportAiOutput_OnClick" Margin="0,0,8,0"/>
                        <Button Content="New" Command="{Binding NewNoteCommand}"/>
                        <Button Content="Save" Margin="8,0,0,0" Command="{Binding SaveNoteCommand}"/>
                        <Button Content="Delete" Margin="8,0,0,0" Command="{Binding DeleteNoteCommand}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Grid>

        <Grid Grid.Column="1" Margin="20" Visibility="{Binding IsCompanyHubSelected, Converter={StaticResource BoolToVisibility}}">
            <Grid.RowDefinitions><RowDefinition Height="Auto"/><RowDefinition Height="*"/></Grid.RowDefinitions>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="Company Hub" FontSize="28" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <ComboBox Width="360" Margin="16,0,0,0" ItemsSource="{Binding CompanyOptions}" SelectedItem="{Binding SelectedHubCompany}" DisplayMemberPath="DisplayName"/>
            </StackPanel>
            <TabControl Grid.Row="1">
                <TabItem Header="Overview"><TextBlock Padding="12" Text="Company intelligence overview."/></TabItem>
                <TabItem Header="Documents"><ListBox ItemsSource="{Binding HubDocuments}"/></TabItem>
                <TabItem Header="Notes"><ListBox ItemsSource="{Binding HubNotes}"/></TabItem>
                <TabItem Header="Events"><ListBox ItemsSource="{Binding HubEvents}"/></TabItem>
                <TabItem Header="Metrics"><ListBox ItemsSource="{Binding HubMetrics}"/></TabItem>
                <TabItem Header="Agent Runs"><ListBox ItemsSource="{Binding HubAgentRuns}"/></TabItem>
            </TabControl>
        </Grid>

        <Grid Grid.Column="1" Background="#FFF8FAFC">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Visibility" Value="Visible" />
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsCompaniesSelected}" Value="True"><Setter Property="Visibility" Value="Collapsed" /></DataTrigger>
                        <DataTrigger Binding="{Binding IsDocumentsSelected}" Value="True"><Setter Property="Visibility" Value="Collapsed" /></DataTrigger>
                        <DataTrigger Binding="{Binding IsNotesSelected}" Value="True"><Setter Property="Visibility" Value="Collapsed" /></DataTrigger>
                        <DataTrigger Binding="{Binding IsCompanyHubSelected}" Value="True"><Setter Property="Visibility" Value="Collapsed" /></DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Width="520">
                <TextBlock Text="This section is under construction." FontSize="24" FontWeight="SemiBold" TextAlignment="Center" />
                <TextBlock Text="Use Companies, Documents, Notes, and Company Hub to manage research workflows." TextAlignment="Center" Margin="0,10,0,0" Foreground="#FF4A5568" TextWrapping="Wrap" />
            </StackPanel>
        </Grid>
    </Grid>
</Window>
